#!/sbin/sh
export OPENGAZIP="$3"
export OUTFD="/proc/self/fd/$2"
export TMP="/tmp"
l="$TMP/bin"
ui_print() {
  echo "ui_print $1
    ui_print" >> $OUTFD
}
#setenforce 0
unzip -o "$OPENGAZIP" -d "$TMP"
set_progress() { echo "set_progress $1" >> $OUTFD; }
#Agora vem o script
#chmoad
set_perm() {
  chown "$1:$2" "$4"
  chmod "$3" "$4"
}
ch_con() {
  chcon -h u:object_r:system_file:s0 "$1"
}
#-/-/-/--//-/-/-/--/-/--/-/-/-/--/-/-/--/-/-
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
ui_print " "
# script2
ui_print "Mountando a partição do sistema "
ui_print " "
set_progress 0.10
mount system && mount -a
ui_print "a partição do sistema foi montada"
sleep 4
if [ -d /system/system ];then
    export SYSTEM=/system/system
    export AS_ROOT="A/B"
else
    export SYSTEM=/system
    export AS_ROOT="A Only"
fi

for i in uname -a do
case $cpu in
    *aarch* ) export $CPU-A="aarch64" ;;
    *arm* ) export $CPU-A="arm7l";;
esac


ui_print "Seu sistema tem a partição: $AS_ROOT"
ui_print "diretorio do seu sistema: $SYSTEM"
ui_print "Sua arquitetura do processador é: $CPU-A"

if [ -e $SYSTEM/app/Youtube/YouTube/*.apk && -d $SYSTEM/app/youtube ];then
    ui_print "Removendo o YouTube"
    rm -rf $SYSTEM/app/YouTube/
    ui_print "Vamos instalar o YouTube Vanced"
else
    ui_print "YouTube não está instalado"
    ui_print "Vamos instalar o YouTube Vanced"
fi

if [ -d $SYSTEM/product/priv-app/Camera2 ];then
    ui_print "Android camera2 AOSP detectado. removendo"
    rm -rf "$SYSTEM/product/priv-app/Camera2"
else
    ui_print "não foi detectado a Camera2 AOSP"
fi

if [ -d $TMP/system ];then
    ui_print "movendo os arquivos"
    ui_print " "
    cp -rf $TMP/system/* $SYSTEM
else
    ui_print "alguns arquivos não foi extraidos. por favor execute de novo.
fi

if [ -e $TMP/logo.bin ];then
    #logo
    ui_print " "
    ui_print "Backup do logo na pasta /data/backup/"
    mkdir /data/backup
    #logo_a
    cp -rf /dev/block/by-name/logo_a /data/backup/logo_a.bin
    rm -rf /dev/block/by-name/logo_a
    #logo_b
    cp -rf /dev/block/by-name/logo_b /data/backup/logo_b.bin
    rm -rf /dev/block/by-name/logo_b
    ui_print "Logo Google para Moto G7 Plus (+)"
    #logos
    cp -rf $TMP/logo.bin /dev/block/by-name/logo_a
    cp -rf $TMP/logo.bin /dev/block/by-name/logo_b
else
    ui_print "arquivo do logo não encontrado."
fi

set_progress 0.92

ui_print "- Completo!"
ui_print " - © Sirherobrine23
ui_print " "

#não me apague
quit
exit